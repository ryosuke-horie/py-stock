"""
ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«æ©Ÿèƒ½
åˆå¿ƒè€…å‘ã‘ã®ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—æŠ•è³‡å­¦ç¿’ã‚¬ã‚¤ãƒ‰
"""

import streamlit as st
from typing import Dict, List, Optional
from datetime import datetime


class TutorialStep:
    """ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã‚¯ãƒ©ã‚¹"""
    
    def __init__(self, step_id: str, title: str, description: str, content: str,
                 interactive_element: Optional[str] = None, next_step: Optional[str] = None):
        self.step_id = step_id
        self.title = title
        self.description = description
        self.content = content
        self.interactive_element = interactive_element
        self.next_step = next_step


class EducationTutorialComponent:
    """ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ"""
    
    def __init__(self):
        """åˆæœŸåŒ–"""
        self.tutorials = self._load_tutorials()
        self._initialize_session_state()
    
    def _initialize_session_state(self):
        """ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹åˆæœŸåŒ–"""
        if 'tutorial_progress' not in st.session_state:
            st.session_state.tutorial_progress = {}
        
        if 'current_tutorial' not in st.session_state:
            st.session_state.current_tutorial = None
        
        if 'current_step' not in st.session_state:
            st.session_state.current_step = 0
    
    def _load_tutorials(self) -> Dict[str, Dict]:
        """ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿"""
        return {
            "basic_investment": {
                "title": "ğŸŒ± æŠ•è³‡ã®åŸºæœ¬",
                "description": "æŠ•è³‡ã®åŸºç¤çŸ¥è­˜ã‹ã‚‰å®Ÿè·µã¾ã§",
                "difficulty": "åˆç´š",
                "duration": "ç´„30åˆ†",
                "steps": [
                    TutorialStep(
                        "basic_001",
                        "æŠ•è³‡ã¨ã¯ä½•ã‹ï¼Ÿ",
                        "æŠ•è³‡ã®åŸºæœ¬æ¦‚å¿µã‚’ç†è§£ã—ã‚ˆã†",
                        """
                        ### ğŸ’¡ æŠ•è³‡ã¨ã¯ï¼Ÿ
                        
                        æŠ•è³‡ã¨ã¯ã€**å°†æ¥ã®ãƒªã‚¿ãƒ¼ãƒ³ã‚’æœŸå¾…ã—ã¦ãŠé‡‘ã‚’è³‡ç”£ã«æŠ•å…¥ã™ã‚‹ã“ã¨**ã§ã™ã€‚
                        
                        #### æŠ•è³‡ã¨è²¯é‡‘ã®é•ã„
                        
                        | é …ç›® | è²¯é‡‘ | æŠ•è³‡ |
                        |------|------|------|
                        | ãƒªã‚¹ã‚¯ | ä½ã„ | é«˜ã„ |
                        | ãƒªã‚¿ãƒ¼ãƒ³ | ä½ã„ï¼ˆå¹´0.01%ç¨‹åº¦ï¼‰ | é«˜ã„ï¼ˆå¹´5-10%ã‚‚å¯èƒ½ï¼‰ |
                        | æµå‹•æ€§ | é«˜ã„ | ä¸­ã€œä½ |
                        | å…ƒæœ¬ä¿è¨¼ | ã‚ã‚Š | ãªã— |
                        
                        #### ãªãœæŠ•è³‡ãŒå¿…è¦ãªã®ã‹ï¼Ÿ
                        
                        1. **ã‚¤ãƒ³ãƒ•ãƒ¬å¯¾ç­–**: ç‰©ä¾¡ä¸Šæ˜‡ã«å¯¾æŠ—
                        2. **è³‡ç”£å¢—åŠ **: é•·æœŸçš„ãªè³‡ç”£å½¢æˆ
                        3. **è€å¾Œè³‡é‡‘**: å¹´é‡‘ã ã‘ã§ã¯ä¸ååˆ†
                        
                        ğŸ’¡ **é‡è¦**: æŠ•è³‡ã¯ä½™è£•è³‡é‡‘ã§è¡Œã†ã“ã¨ãŒé‰„å‰‡ã§ã™ï¼
                        """,
                        "quiz",
                        "basic_002"
                    ),
                    TutorialStep(
                        "basic_002", 
                        "æ ªå¼æŠ•è³‡ã®ä»•çµ„ã¿",
                        "æ ªå¼ã¨ã¯ä½•ã‹ã€ã©ã†åˆ©ç›Šã‚’å¾—ã‚‹ã‹ã‚’å­¦ã¼ã†",
                        """
                        ### ğŸ“ˆ æ ªå¼æŠ•è³‡ã¨ã¯ï¼Ÿ
                        
                        æ ªå¼æŠ•è³‡ã¯**ä¼æ¥­ã®ä¸€éƒ¨ã‚’æ‰€æœ‰ã™ã‚‹ã“ã¨**ã§ã™ã€‚
                        
                        #### æ ªå¼ã§åˆ©ç›Šã‚’å¾—ã‚‹2ã¤ã®æ–¹æ³•
                        
                        1. **ã‚­ãƒ£ãƒ”ã‚¿ãƒ«ã‚²ã‚¤ãƒ³ï¼ˆå€¤ä¸ŠãŒã‚Šç›Šï¼‰**
                           - æ ªä¾¡ã®ä¸Šæ˜‡ã«ã‚ˆã‚‹åˆ©ç›Š
                           - ä¾‹ï¼š1000å††ã§è²·ã£ãŸæ ªãŒ1200å††ã«ãªã£ãŸã‚‰200å††ã®åˆ©ç›Š
                        
                        2. **ã‚¤ãƒ³ã‚«ãƒ ã‚²ã‚¤ãƒ³ï¼ˆé…å½“é‡‘ï¼‰**
                           - ä¼æ¥­ãŒæ ªä¸»ã«åˆ†é…ã™ã‚‹åˆ©ç›Š
                           - ä¾‹ï¼šå¹´é–“50å††ã®é…å½“ã‚’ã‚‚ã‚‰ã†
                        
                        #### æ ªä¾¡ãŒå‹•ãç†ç”±
                        
                        - ğŸ“Š **æ¥­ç¸¾**: ä¼æ¥­ã®å£²ä¸Šãƒ»åˆ©ç›Š
                        - ğŸŒ **çµŒæ¸ˆæƒ…å‹¢**: é‡‘åˆ©ã€ç‚ºæ›¿ã€çµŒæ¸ˆæˆé•·
                        - ğŸ˜¨ **å¸‚å ´å¿ƒç†**: æŠ•è³‡å®¶ã®æœŸå¾…ã¨ä¸å®‰
                        - ğŸ“° **ãƒ‹ãƒ¥ãƒ¼ã‚¹**: ä¼æ¥­ç™ºè¡¨ã€ç¤¾ä¼šæƒ…å‹¢
                        
                        #### ãƒªã‚¹ã‚¯ã«ã¤ã„ã¦
                        
                        âš ï¸ **æ ªä¾¡ã¯ä¸‹ãŒã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™**
                        - ä¼æ¥­æ¥­ç¸¾ã®æ‚ªåŒ–
                        - å¸‚å ´å…¨ä½“ã®ä¸‹è½
                        - äºˆæœŸã›ã¬äº‹ä»¶ãƒ»äº‹æ•…
                        """,
                        "calculation",
                        "basic_003"
                    ),
                    TutorialStep(
                        "basic_003",
                        "è¨¼åˆ¸å£åº§ã®é–‹è¨­",
                        "å®Ÿéš›ã«æŠ•è³‡ã‚’å§‹ã‚ã‚‹ãŸã‚ã®æº–å‚™",
                        """
                        ### ğŸ¦ è¨¼åˆ¸å£åº§ã‚’é–‹è¨­ã—ã‚ˆã†
                        
                        æ ªå¼æŠ•è³‡ã‚’å§‹ã‚ã‚‹ã«ã¯**è¨¼åˆ¸å£åº§**ãŒå¿…è¦ã§ã™ã€‚
                        
                        #### ä¸»ãªè¨¼åˆ¸ä¼šç¤¾ã®ç‰¹å¾´
                        
                        **ãƒãƒƒãƒˆè¨¼åˆ¸ï¼ˆãŠã™ã™ã‚ï¼‰**
                        - ğŸŒŸ **SBIè¨¼åˆ¸**: æœ€å¤§æ‰‹ã€å•†å“è±Šå¯Œ
                        - ğŸŒŸ **æ¥½å¤©è¨¼åˆ¸**: æ¥½å¤©ãƒã‚¤ãƒ³ãƒˆæ´»ç”¨
                        - ğŸŒŸ **ãƒãƒãƒƒã‚¯ã‚¹è¨¼åˆ¸**: ç±³å›½æ ªã«å¼·ã„
                        
                        **æ‰‹æ•°æ–™æ¯”è¼ƒï¼ˆ1å›ã®å–å¼•ï¼‰**
                        
                        | å–å¼•é‡‘é¡ | SBIè¨¼åˆ¸ | æ¥½å¤©è¨¼åˆ¸ | å¤§æ‰‹å¯¾é¢è¨¼åˆ¸ |
                        |----------|---------|----------|--------------|
                        | 10ä¸‡å††ä»¥ä¸‹ | 99å†† | 99å†† | 1,000å††ä»¥ä¸Š |
                        | 50ä¸‡å††ä»¥ä¸‹ | 275å†† | 275å†† | 5,000å††ä»¥ä¸Š |
                        
                        #### å£åº§é–‹è¨­ã®æµã‚Œ
                        
                        1. **ğŸŒ Webã‚µã‚¤ãƒˆã‹ã‚‰ç”³è¾¼ã¿**
                        2. **ğŸ“‹ å¿…è¦æ›¸é¡ã®æå‡º**
                           - æœ¬äººç¢ºèªæ›¸é¡ï¼ˆå…è¨±è¨¼ãªã©ï¼‰
                           - ãƒã‚¤ãƒŠãƒ³ãƒãƒ¼æ›¸é¡
                        3. **ğŸ“ ç°¡å˜ãªå¯©æŸ»**
                        4. **ğŸ“® å£åº§é–‹è¨­é€šçŸ¥ã®å—å–ã‚Š**
                        
                        #### NISAå£åº§ã‚‚ä¸€ç·’ã«é–‹è¨­
                        
                        ğŸ’° **ã¤ã¿ãŸã¦NISA**: å¹´40ä¸‡å††ã¾ã§éèª²ç¨
                        ğŸ’° **ä¸€èˆ¬NISA**: å¹´120ä¸‡å††ã¾ã§éèª²ç¨
                        
                        â­ **åˆå¿ƒè€…ã«ã¯ã¤ã¿ãŸã¦NISAãŒãŠã™ã™ã‚**
                        """,
                        "checklist",
                        "basic_004"
                    ),
                    TutorialStep(
                        "basic_004",
                        "æŠ•è³‡è³‡é‡‘ã®æº–å‚™",
                        "ã„ãã‚‰ã‹ã‚‰å§‹ã‚ã‚‹ï¼Ÿè³‡é‡‘ç®¡ç†ã®åŸºæœ¬",
                        """
                        ### ğŸ’° æŠ•è³‡è³‡é‡‘ã‚’ã©ã†æº–å‚™ã™ã‚‹ï¼Ÿ
                        
                        #### æŠ•è³‡ã«å›ã›ã‚‹è³‡é‡‘ã®ç›®å®‰
                        
                        **3ã¤ã®è³‡é‡‘ã«åˆ†ã‘ã¦è€ƒãˆã‚ˆã†**
                        
                        1. **ç”Ÿæ´»è²»** (æœˆåã®6ãƒ¶æœˆåˆ†)
                           - ç·Šæ€¥æ™‚ã«å¿…è¦ãªè³‡é‡‘
                           - æ™®é€šé é‡‘ã§ä¿ç®¡
                        
                        2. **çŸ­æœŸè³‡é‡‘** (1-3å¹´ä»¥å†…ã«ä½¿ã†äºˆå®š)
                           - çµå©šã€è»Šè³¼å…¥ã€æ—…è¡Œãªã©
                           - å®šæœŸé é‡‘ã‚„ä½ãƒªã‚¹ã‚¯æŠ•è³‡
                        
                        3. **é•·æœŸè³‡é‡‘** (3å¹´ä»¥ä¸Šä½¿ã‚ãªã„)
                           - è€å¾Œè³‡é‡‘ã€æ•™è‚²è³‡é‡‘
                           - **ã“ã®éƒ¨åˆ†ã‚’æŠ•è³‡ã«å›ã™**
                        
                        #### æŠ•è³‡é‡‘é¡ã®ä¾‹
                        
                        **æœˆå30ä¸‡å††ã®å ´åˆ**
                        - ç”Ÿæ´»è²»ç¢ºä¿ï¼š180ä¸‡å††
                        - çŸ­æœŸè³‡é‡‘ï¼š100ä¸‡å††
                        - æŠ•è³‡å¯èƒ½é¡ï¼š**æ¯æœˆ3-5ä¸‡å††**
                        
                        #### å°‘é¡ã‹ã‚‰å§‹ã‚ã‚ˆã†
                        
                        ğŸ“Š **æœˆ1ä¸‡å††ã‹ã‚‰å§‹ã‚ã‚‰ã‚Œã¾ã™**
                        
                        | æœˆé¡ | 10å¹´å¾Œ | 20å¹´å¾Œ | 30å¹´å¾Œ |
                        |------|--------|--------|--------|
                        | 1ä¸‡å†† | 156ä¸‡å†† | 411ä¸‡å†† | 849ä¸‡å†† |
                        | 3ä¸‡å†† | 468ä¸‡å†† | 1,233ä¸‡å†† | 2,547ä¸‡å†† |
                        | 5ä¸‡å†† | 780ä¸‡å†† | 2,055ä¸‡å†† | 4,245ä¸‡å†† |
                        
                        *å¹´åˆ©5%ã§è¨ˆç®—ï¼ˆè¤‡åˆ©åŠ¹æœå«ã‚€ï¼‰
                        
                        âš ï¸ **å€Ÿé‡‘ã‚’ã—ã¦æŠ•è³‡ã¯çµ¶å¯¾NGï¼**
                        """,
                        "calculator",
                        "basic_005"
                    ),
                    TutorialStep(
                        "basic_005",
                        "åˆå›æŠ•è³‡ã®å®Ÿè·µ",
                        "å®Ÿéš›ã«æ ªã‚’è²·ã£ã¦ã¿ã‚ˆã†",
                        """
                        ### ğŸ›’ åˆã‚ã¦ã®æ ªå¼è³¼å…¥
                        
                        #### åˆå¿ƒè€…ã«ãŠã™ã™ã‚ã®æŠ•è³‡æ–¹æ³•
                        
                        **1. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æŠ•è³‡ï¼ˆæœ€æ¨å¥¨ï¼‰**
                        - ğŸ“Š å…¨ä½“ã«åˆ†æ•£æŠ•è³‡
                        - ğŸ† å•†å“ä¾‹ï¼šã€ŒeMAXIS Slim å…¨ä¸–ç•Œæ ªå¼ã€
                        - ğŸ’¡ æ¯æœˆå®šé¡è³¼å…¥ï¼ˆç©ç«‹æŠ•è³‡ï¼‰
                        
                        **2. æ—¥æœ¬ã®å¤§å‹æ ª**
                        - ğŸ¢ å®‰å®šã—ãŸå¤§ä¼æ¥­
                        - ğŸ† ä¾‹ï¼šãƒˆãƒ¨ã‚¿(7203)ã€NTT(9432)
                        - ğŸ’¡ 100æ ªå˜ä½ã§ã®è³¼å…¥
                        
                        #### æ³¨æ–‡ã®æµã‚Œ
                        
                        **ğŸ“± è¨¼åˆ¸ä¼šç¤¾ã‚¢ãƒ—ãƒªãƒ»ã‚µã‚¤ãƒˆã§æ“ä½œ**
                        
                        1. **éŠ˜æŸ„æ¤œç´¢**: ã€Œãƒˆãƒ¨ã‚¿ã€ã€Œ7203ã€ãªã©
                        2. **æ³¨æ–‡æ–¹æ³•é¸æŠ**
                           - ğŸ“Š **æˆè¡Œæ³¨æ–‡**: ã™ãã«è²·ãˆã‚‹
                           - ğŸ¯ **æŒ‡å€¤æ³¨æ–‡**: ä¾¡æ ¼ã‚’æŒ‡å®š
                        3. **æ•°é‡å…¥åŠ›**: 100æ ªã€200æ ªãªã©
                        4. **æ³¨æ–‡ç¢ºèª**: å†…å®¹ã‚’ç¢ºèªã—ã¦å®Ÿè¡Œ
                        
                        #### åˆå›è³¼å…¥ã®ãƒã‚¤ãƒ³ãƒˆ
                        
                        âœ… **å°‘é¡ã‹ã‚‰å§‹ã‚ã‚‹**: 10-30ä¸‡å††ç¨‹åº¦
                        âœ… **æœ‰åä¼æ¥­ã‚’é¸ã¶**: ã‚ˆãçŸ¥ã£ã¦ã„ã‚‹ä¼šç¤¾
                        âœ… **ä¸€åº¦ã«è²·ã‚ãªã„**: 3-4å›ã«åˆ†ã‘ã¦è³¼å…¥
                        âœ… **é•·æœŸä¿æœ‰ã®è¦šæ‚Ÿ**: çŸ­æœŸå£²è²·ã¯é¿ã‘ã‚‹
                        
                        #### ã‚ˆãã‚ã‚‹å¤±æ•—
                        
                        âŒ **ã„ããªã‚Šé«˜é¡æŠ•è³‡**
                        âŒ **çŸ¥ã‚‰ãªã„ä¼šç¤¾ã®æ ªã‚’è³¼å…¥**
                        âŒ **å€¤å‹•ãã«ä¸€å–œä¸€æ†‚**
                        âŒ **å€Ÿé‡‘ã—ã¦æŠ•è³‡**
                        """,
                        "simulation",
                        None
                    )
                ]
            },
            
            "technical_analysis": {
                "title": "ğŸ“Š ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«åˆ†æå…¥é–€",
                "description": "ãƒãƒ£ãƒ¼ãƒˆã®èª­ã¿æ–¹ã¨åˆ†ææ‰‹æ³•",
                "difficulty": "ä¸­ç´š",
                "duration": "ç´„45åˆ†",
                "steps": [
                    TutorialStep(
                        "tech_001",
                        "ãƒãƒ£ãƒ¼ãƒˆã®åŸºæœ¬",
                        "ãƒ­ãƒ¼ã‚½ã‚¯è¶³ã¨ãƒˆãƒ¬ãƒ³ãƒ‰ã®è¦‹æ–¹",
                        """
                        ### ğŸ“Š æ ªä¾¡ãƒãƒ£ãƒ¼ãƒˆã‚’èª­ã‚‚ã†
                        
                        #### ãƒ­ãƒ¼ã‚½ã‚¯è¶³ã®è¦‹æ–¹
                        
                        ãƒ­ãƒ¼ã‚½ã‚¯è¶³ã¯**1æ—¥ã®å€¤å‹•ãã‚’è¡¨ç¾**ã—ã¾ã™ã€‚
                        
                        **ğŸ•¯ï¸ ãƒ­ãƒ¼ã‚½ã‚¯è¶³ã®æ§‹æˆ**
                        - **å§‹å€¤**: ãã®æ—¥ã®æœ€åˆã®ä¾¡æ ¼
                        - **é«˜å€¤**: ãã®æ—¥ã®æœ€é«˜ä¾¡æ ¼
                        - **å®‰å€¤**: ãã®æ—¥ã®æœ€å®‰ä¾¡æ ¼
                        - **çµ‚å€¤**: ãã®æ—¥ã®æœ€å¾Œã®ä¾¡æ ¼
                        
                        **è‰²ã®æ„å‘³**
                        - ğŸŸ¢ **é™½ç·š**: çµ‚å€¤ > å§‹å€¤ï¼ˆä¸Šæ˜‡ï¼‰
                        - ğŸ”´ **é™°ç·š**: çµ‚å€¤ < å§‹å€¤ï¼ˆä¸‹è½ï¼‰
                        
                        #### ãƒˆãƒ¬ãƒ³ãƒ‰ã®ç¨®é¡
                        
                        ğŸ“ˆ **ä¸Šæ˜‡ãƒˆãƒ¬ãƒ³ãƒ‰**: é«˜å€¤ãƒ»å®‰å€¤ãŒåˆ‡ã‚Šä¸ŠãŒã‚‹
                        ğŸ“‰ **ä¸‹é™ãƒˆãƒ¬ãƒ³ãƒ‰**: é«˜å€¤ãƒ»å®‰å€¤ãŒåˆ‡ã‚Šä¸‹ãŒã‚‹
                        â¡ï¸ **æ¨ªã°ã„ãƒˆãƒ¬ãƒ³ãƒ‰**: ä¸€å®šã®ç¯„å›²ã§æ¨ç§»
                        
                        #### é‡è¦ãªãƒ‘ã‚¿ãƒ¼ãƒ³
                        
                        **ğŸ”„ åè»¢ãƒ‘ã‚¿ãƒ¼ãƒ³**
                        - ãƒ€ãƒ–ãƒ«ãƒˆãƒƒãƒ—ãƒ»ãƒ€ãƒ–ãƒ«ãƒœãƒˆãƒ 
                        - ãƒ˜ãƒƒãƒ‰&ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼
                        
                        **â¡ï¸ ç¶™ç¶šãƒ‘ã‚¿ãƒ¼ãƒ³**
                        - ä¸‰è§’ä¿ã¡åˆã„
                        - ãƒ•ãƒ©ãƒƒã‚°ãƒ»ãƒšãƒŠãƒ³ãƒˆ
                        """,
                        "chart_reading",
                        "tech_002"
                    ),
                    TutorialStep(
                        "tech_002",
                        "ç§»å‹•å¹³å‡ç·š",
                        "ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’æŠŠæ¡ã™ã‚‹åŸºæœ¬æŒ‡æ¨™",
                        """
                        ### ğŸ“ˆ ç§»å‹•å¹³å‡ç·šã¨ã¯ï¼Ÿ
                        
                        ç§»å‹•å¹³å‡ç·šã¯**éå»næ—¥é–“ã®çµ‚å€¤ã®å¹³å‡**ã‚’ç·šã§çµã‚“ã ã‚‚ã®ã§ã™ã€‚
                        
                        #### ã‚ˆãä½¿ã‚ã‚Œã‚‹æœŸé–“
                        
                        - **25æ—¥ç·š**: çŸ­æœŸãƒˆãƒ¬ãƒ³ãƒ‰
                        - **75æ—¥ç·š**: ä¸­æœŸãƒˆãƒ¬ãƒ³ãƒ‰  
                        - **200æ—¥ç·š**: é•·æœŸãƒˆãƒ¬ãƒ³ãƒ‰
                        
                        #### ç§»å‹•å¹³å‡ç·šã®ä½¿ã„æ–¹
                        
                        **ğŸ“Š ãƒˆãƒ¬ãƒ³ãƒ‰åˆ¤æ–­**
                        - ç§»å‹•å¹³å‡ç·šãŒä¸Šå‘ã â†’ ä¸Šæ˜‡ãƒˆãƒ¬ãƒ³ãƒ‰
                        - ç§»å‹•å¹³å‡ç·šãŒä¸‹å‘ã â†’ ä¸‹é™ãƒˆãƒ¬ãƒ³ãƒ‰
                        
                        **ğŸ¯ å£²è²·ã‚·ã‚°ãƒŠãƒ«**
                        - æ ªä¾¡ãŒç§»å‹•å¹³å‡ç·šã‚’ä¸ŠæŠœã‘ â†’ è²·ã„ã‚·ã‚°ãƒŠãƒ«
                        - æ ªä¾¡ãŒç§»å‹•å¹³å‡ç·šã‚’ä¸‹æŠœã‘ â†’ å£²ã‚Šã‚·ã‚°ãƒŠãƒ«
                        
                        #### ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¯ãƒ­ã‚¹ãƒ»ãƒ‡ãƒƒãƒ‰ã‚¯ãƒ­ã‚¹
                        
                        **ğŸŒŸ ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¯ãƒ­ã‚¹ï¼ˆè²·ã„ã‚·ã‚°ãƒŠãƒ«ï¼‰**
                        - çŸ­æœŸç·šãŒé•·æœŸç·šã‚’ä¸‹ã‹ã‚‰ä¸Šã«æŠœã‘ã‚‹
                        - ä¾‹ï¼š25æ—¥ç·šãŒ75æ—¥ç·šã‚’ä¸ŠæŠœã‘
                        
                        **ğŸ’€ ãƒ‡ãƒƒãƒ‰ã‚¯ãƒ­ã‚¹ï¼ˆå£²ã‚Šã‚·ã‚°ãƒŠãƒ«ï¼‰**
                        - çŸ­æœŸç·šãŒé•·æœŸç·šã‚’ä¸Šã‹ã‚‰ä¸‹ã«æŠœã‘ã‚‹
                        - ä¾‹ï¼š25æ—¥ç·šãŒ75æ—¥ç·šã‚’ä¸‹æŠœã‘
                        
                        #### æ³¨æ„ç‚¹
                        
                        âš ï¸ **ã ã¾ã—ãŒã‚ã‚‹**
                        - çŸ­æœŸçš„ãªä¸ŠæŠœã‘ãƒ»ä¸‹æŠœã‘ã«æ³¨æ„
                        - è¤‡æ•°ã®æŒ‡æ¨™ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒé‡è¦
                        """,
                        "ma_practice",
                        "tech_003"
                    ),
                    TutorialStep(
                        "tech_003",
                        "RSIã¨MACDã®æ´»ç”¨",
                        "ã‚ªã‚·ãƒ¬ãƒ¼ã‚¿ãƒ¼ç³»æŒ‡æ¨™ã§å£²è²·ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’åˆ¤æ–­",
                        """
                        ### ğŸ“Š RSIï¼ˆç›¸å¯¾åŠ›æŒ‡æ•°ï¼‰
                        
                        RSIã¯**è²·ã‚ã‚Œéããƒ»å£²ã‚‰ã‚Œéãã‚’åˆ¤æ–­**ã™ã‚‹æŒ‡æ¨™ã§ã™ã€‚
                        
                        #### RSIã®è¦‹æ–¹
                        
                        **æ•°å€¤ã®æ„å‘³**
                        - 0-100ã®å€¤ã§æ¨ç§»
                        - 70ä»¥ä¸Šï¼šè²·ã‚ã‚Œéãï¼ˆå£²ã‚Šã‚·ã‚°ãƒŠãƒ«ï¼‰
                        - 30ä»¥ä¸‹ï¼šå£²ã‚‰ã‚Œéãï¼ˆè²·ã„ã‚·ã‚°ãƒŠãƒ«ï¼‰
                        
                        **ğŸ¯ å£²è²·ã‚·ã‚°ãƒŠãƒ«**
                        - RSI > 70 â†’ å£²ã‚Šæ¤œè¨
                        - RSI < 30 â†’ è²·ã„æ¤œè¨
                        
                        ### ğŸ“Š MACD
                        
                        MACDã¯**ãƒˆãƒ¬ãƒ³ãƒ‰ã®å¤‰åŒ–ã‚’æ‰ãˆã‚‹**æŒ‡æ¨™ã§ã™ã€‚
                        
                        #### MACDã®æ§‹æˆ
                        
                        - **MACDãƒ©ã‚¤ãƒ³**: çŸ­æœŸEMA - é•·æœŸEMA
                        - **ã‚·ã‚°ãƒŠãƒ«ãƒ©ã‚¤ãƒ³**: MACDã®ç§»å‹•å¹³å‡
                        - **ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ **: MACD - ã‚·ã‚°ãƒŠãƒ«
                        
                        #### å£²è²·ã‚·ã‚°ãƒŠãƒ«
                        
                        **ğŸŒŸ è²·ã„ã‚·ã‚°ãƒŠãƒ«**
                        - MACDãŒã‚·ã‚°ãƒŠãƒ«ç·šã‚’ä¸ŠæŠœã‘
                        - ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ãŒãƒ—ãƒ©ã‚¹è»¢æ›
                        
                        **ğŸ’€ å£²ã‚Šã‚·ã‚°ãƒŠãƒ«**
                        - MACDãŒã‚·ã‚°ãƒŠãƒ«ç·šã‚’ä¸‹æŠœã‘
                        - ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ãŒãƒã‚¤ãƒŠã‚¹è»¢æ›
                        
                        #### çµ„ã¿åˆã‚ã›ã¦ä½¿ã†
                        
                        ğŸ“Š **è¤‡æ•°æŒ‡æ¨™ã§ã®ç¢ºèª**
                        1. ãƒˆãƒ¬ãƒ³ãƒ‰æ–¹å‘ï¼ˆç§»å‹•å¹³å‡ç·šï¼‰
                        2. è²·ã‚ã‚Œéããƒ»å£²ã‚‰ã‚Œéãï¼ˆRSIï¼‰
                        3. è»¢æ›ç‚¹ï¼ˆMACDï¼‰
                        
                        **ä¾‹ï¼šè²·ã„ã®æ¡ä»¶**
                        - 25æ—¥ç·šãŒä¸Šå‘ã
                        - RSI < 30ã‹ã‚‰å›å¾©
                        - MACDãŒã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¯ãƒ­ã‚¹
                        """,
                        "oscillator_practice",
                        None
                    )
                ]
            },
            
            "risk_management": {
                "title": "âš–ï¸ ãƒªã‚¹ã‚¯ç®¡ç†",
                "description": "æå¤±ã‚’æŠ‘ãˆã‚‹æŠ•è³‡æˆ¦ç•¥",
                "difficulty": "ä¸­ç´š",
                "duration": "ç´„20åˆ†",
                "steps": [
                    TutorialStep(
                        "risk_001",
                        "ãƒªã‚¹ã‚¯ã®ç¨®é¡",
                        "æŠ•è³‡ã«ã¯ã©ã‚“ãªãƒªã‚¹ã‚¯ãŒã‚ã‚‹ã‹",
                        """
                        ### âš ï¸ æŠ•è³‡ã®ãƒªã‚¹ã‚¯ã‚’ç†è§£ã—ã‚ˆã†
                        
                        æŠ•è³‡ã«ã¯æ§˜ã€…ãªãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚**ãƒªã‚¹ã‚¯ã‚’çŸ¥ã‚‹ã“ã¨ãŒãƒªã‚¹ã‚¯ç®¡ç†ã®ç¬¬ä¸€æ­©**ã§ã™ã€‚
                        
                        #### ä¸»ãªãƒªã‚¹ã‚¯ã®ç¨®é¡
                        
                        **1. ğŸ¢ ä¿¡ç”¨ãƒªã‚¹ã‚¯**
                        - ä¼æ¥­ã®å€’ç”£ãƒ»æ¥­ç¸¾æ‚ªåŒ–
                        - å¯¾ç­–ï¼šè²¡å‹™å¥å…¨æ€§ã‚’ãƒã‚§ãƒƒã‚¯
                        
                        **2. ğŸŒ å¸‚å ´ãƒªã‚¹ã‚¯**
                        - å…¨ä½“çš„ãªæ ªä¾¡ä¸‹è½
                        - å¯¾ç­–ï¼šåˆ†æ•£æŠ•è³‡ã€é•·æœŸæŠ•è³‡
                        
                        **3. ğŸ’± ç‚ºæ›¿ãƒªã‚¹ã‚¯**
                        - å¤–å›½æ ªæŠ•è³‡æ™‚ã®ç‚ºæ›¿å¤‰å‹•
                        - å¯¾ç­–ï¼šé€šè²¨åˆ†æ•£
                        
                        **4. ğŸ’§ æµå‹•æ€§ãƒªã‚¹ã‚¯**
                        - å£²ã‚ŠãŸã„æ™‚ã«å£²ã‚Œãªã„
                        - å¯¾ç­–ï¼šå‡ºæ¥é«˜ã®å¤šã„éŠ˜æŸ„é¸æŠ
                        
                        **5. ğŸ“ˆ ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯**
                        - ä¾¡æ ¼å¤‰å‹•ã®æ¿€ã—ã•
                        - å¯¾ç­–ï¼šãƒªã‚¹ã‚¯è¨±å®¹åº¦ã«å¿œã˜ãŸæŠ•è³‡
                        
                        #### ãƒªã‚¹ã‚¯ã¨ãƒªã‚¿ãƒ¼ãƒ³ã®é–¢ä¿‚
                        
                        ğŸ’¡ **åŸºæœ¬åŸå‰‡ï¼šãƒã‚¤ãƒªã‚¹ã‚¯ãƒ»ãƒã‚¤ãƒªã‚¿ãƒ¼ãƒ³**
                        
                        | æŠ•è³‡å¯¾è±¡ | ãƒªã‚¹ã‚¯ | æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³ |
                        |----------|--------|--------------|
                        | é é‡‘ | æ¥µä½ | 0.01% |
                        | å›½å‚µ | ä½ | 0.5-1% |
                        | æŠ•è³‡ä¿¡è¨— | ä¸­ | 3-7% |
                        | å€‹åˆ¥æ ª | é«˜ | 5-15% |
                        | æ–°èˆˆæ ª | æ¥µé«˜ | -50%ã€œ+100% |
                        """,
                        "risk_assessment",
                        "risk_002"
                    ),
                    TutorialStep(
                        "risk_002",
                        "åˆ†æ•£æŠ•è³‡",
                        "ã€Œåµã¯ä¸€ã¤ã®ã‚«ã‚´ã«ç››ã‚‹ãªã€",
                        """
                        ### ğŸ—‚ï¸ åˆ†æ•£æŠ•è³‡ã§ãƒªã‚¹ã‚¯ã‚’è»½æ¸›
                        
                        åˆ†æ•£æŠ•è³‡ã¯**æŠ•è³‡ã®åŸºæœ¬ä¸­ã®åŸºæœ¬**ã§ã™ã€‚
                        
                        #### åˆ†æ•£ã®ç¨®é¡
                        
                        **1. ğŸ¢ éŠ˜æŸ„åˆ†æ•£**
                        - è¤‡æ•°ã®ä¼šç¤¾ã«æŠ•è³‡
                        - 1ã¤ã®ä¼šç¤¾ãŒæ‚ªããªã£ã¦ã‚‚å½±éŸ¿ã‚’é™å®š
                        
                        **2. ğŸ­ æ¥­ç¨®åˆ†æ•£**
                        - ç•°ãªã‚‹æ¥­ç•Œã«æŠ•è³‡
                        - ITã€é‡‘èã€è£½é€ æ¥­ã€å°å£²ãªã©
                        
                        **3. ğŸŒ åœ°åŸŸåˆ†æ•£**
                        - å›½å†…å¤–ã«æŠ•è³‡
                        - æ—¥æœ¬ã€ç±³å›½ã€æ¬§å·ã€æ–°èˆˆå›½
                        
                        **4. â° æ™‚é–“åˆ†æ•£**
                        - è³¼å…¥æ™‚æœŸã‚’åˆ†æ•£
                        - æ¯æœˆå®šé¡è³¼å…¥ï¼ˆãƒ‰ãƒ«ã‚³ã‚¹ãƒˆå¹³å‡æ³•ï¼‰
                        
                        #### åˆ†æ•£æŠ•è³‡ã®åŠ¹æœ
                        
                        **ä¾‹ï¼š3éŠ˜æŸ„ã¸ã®åˆ†æ•£æŠ•è³‡**
                        
                        | ã‚·ãƒŠãƒªã‚ª | Aç¤¾ | Bç¤¾ | Cç¤¾ | å¹³å‡ |
                        |----------|-----|-----|-----|------|
                        | å¥½èª¿æ™‚ | +30% | +10% | +5% | +15% |
                        | ä¸èª¿æ™‚ | -20% | -5% | +2% | -7.7% |
                        
                        é›†ä¸­æŠ•è³‡ãªã‚‰Aç¤¾ã ã‘ã§-20%ã®æå¤±
                        åˆ†æ•£æŠ•è³‡ãªã‚‰-7.7%ã«æå¤±ã‚’æŠ‘åˆ¶
                        
                        #### ç°¡å˜ãªåˆ†æ•£æŠ•è³‡æ–¹æ³•
                        
                        **ğŸŒŸ æŠ•è³‡ä¿¡è¨—ãƒ»ETFæ´»ç”¨**
                        - 1ã¤ã®å•†å“ã§æ•°ç™¾ã€œæ•°åƒéŠ˜æŸ„ã«åˆ†æ•£
                        - ä¾‹ï¼šæ—¥çµŒ225ã€S&P500é€£å‹•å•†å“
                        - å°‘é¡ã‹ã‚‰å§‹ã‚ã‚‰ã‚Œã‚‹
                        
                        **ğŸ¯ ç›®å®‰ï¼šæœ€ä½ã§ã‚‚10éŠ˜æŸ„ä»¥ä¸Š**
                        """,
                        "diversification_game",
                        "risk_003"
                    ),
                    TutorialStep(
                        "risk_003",
                        "æåˆ‡ã‚Šã¨åˆ©ç¢º",
                        "æ„Ÿæƒ…ã«æƒ‘ã‚ã•ã‚Œãªã„å£²è²·ãƒ«ãƒ¼ãƒ«",
                        """
                        ### âœ‚ï¸ æåˆ‡ã‚Šï¼ˆã‚¹ãƒˆãƒƒãƒ—ãƒ­ã‚¹ï¼‰
                        
                        æåˆ‡ã‚Šã¯**æå¤±ã®æ‹¡å¤§ã‚’é˜²ãé‡è¦ãªæ‰‹æ³•**ã§ã™ã€‚
                        
                        #### æåˆ‡ã‚Šã®åŸºæœ¬ãƒ«ãƒ¼ãƒ«
                        
                        **ğŸ“‰ ä¾¡æ ¼ãƒ™ãƒ¼ã‚¹**
                        - è³¼å…¥ä¾¡æ ¼ã®-10%ã§æåˆ‡ã‚Š
                        - ä¾‹ï¼š1000å††ã§è³¼å…¥ â†’ 900å††ã§å£²å´
                        
                        **ğŸ“Š ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ãƒ™ãƒ¼ã‚¹**
                        - ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³å‰²ã‚Œã§æåˆ‡ã‚Š
                        - ç§»å‹•å¹³å‡ç·šå‰²ã‚Œã§æåˆ‡ã‚Š
                        
                        **â° æ™‚é–“ãƒ™ãƒ¼ã‚¹**
                        - 3ãƒ¶æœˆçµŒã£ã¦ã‚‚åˆ©ç›ŠãŒå‡ºãªã„å ´åˆ
                        
                        #### æåˆ‡ã‚ŠãŒã§ããªã„å¿ƒç†
                        
                        ğŸ˜° **ã‚ˆãã‚ã‚‹å¿ƒç†**
                        - ã€Œã‚‚ã†å°‘ã—å¾…ã¦ã°æˆ»ã‚‹ã‹ã‚‚ã€
                        - ã€Œæã‚’ç¢ºå®šã•ã›ãŸããªã„ã€
                        - ã€Œä»Šå£²ã£ãŸã‚‰è² ã‘ã‚’èªã‚ã‚‹ã“ã¨ã«ãªã‚‹ã€
                        
                        ğŸ’¡ **å¯¾ç­–**
                        - è³¼å…¥æ™‚ã«æåˆ‡ã‚Šä¾¡æ ¼ã‚’æ±ºã‚ã‚‹
                        - è‡ªå‹•å£²è²·æ³¨æ–‡ã‚’æ´»ç”¨
                        - æŠ•è³‡æ—¥è¨˜ã§æ„Ÿæƒ…ã‚’è¨˜éŒ²
                        
                        ### ğŸ“ˆ åˆ©ç¢ºï¼ˆåˆ©ç›Šç¢ºå®šï¼‰
                        
                        #### åˆ©ç¢ºã®æ–¹æ³•
                        
                        **ğŸ¯ ç›®æ¨™ä¾¡æ ¼è¨­å®š**
                        - è³¼å…¥ä¾¡æ ¼ã®+20%ã§åŠåˆ†å£²å´
                        - +50%ã§æ®‹ã‚ŠåŠåˆ†å£²å´
                        
                        **ğŸ“Š æ®µéšçš„åˆ©ç¢º**
                        - åˆ©ç›Šã®å‡ºã¦ã„ã‚‹éƒ¨åˆ†ã‚’å¾ã€…ã«å£²å´
                        - ãƒªã‚¹ã‚¯ã‚’æ®µéšçš„ã«è»½æ¸›
                        
                        **â° æœŸé–“ãƒ™ãƒ¼ã‚¹**
                        - 1å¹´ä¿æœ‰ã§ä¸€éƒ¨åˆ©ç¢º
                        - å¹´æœ«ã®ç¨å‹™èª¿æ•´
                        
                        #### åˆ©ç¢ºãƒ»æåˆ‡ã‚Šã®å®Ÿä¾‹
                        
                        **ä¾‹ï¼š1000å††ã§100æ ªè³¼å…¥**
                        - 900å††ï¼ˆ-10%ï¼‰: å…¨æ ªæåˆ‡ã‚Š
                        - 1200å††ï¼ˆ+20%ï¼‰: 50æ ªåˆ©ç¢º
                        - 1500å††ï¼ˆ+50%ï¼‰: æ®‹ã‚Š50æ ªåˆ©ç¢º
                        
                        ğŸ’¡ **é‡è¦**: ãƒ«ãƒ¼ãƒ«ã‚’æ±ºã‚ãŸã‚‰æ„Ÿæƒ…ã«å·¦å³ã•ã‚Œãšå®Ÿè¡Œï¼
                        """,
                        "stop_loss_game",
                        None
                    )
                ]
            }
        }
    
    def display(self):
        """ãƒ¡ã‚¤ãƒ³è¡¨ç¤º"""
        st.header("ğŸ“ ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«")
        
        # ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é¸æŠ
        if st.session_state.current_tutorial is None:
            self._display_tutorial_selection()
        else:
            self._display_tutorial_content()
    
    def _display_tutorial_selection(self):
        """ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é¸æŠç”»é¢"""
        st.subheader("ğŸ“š å­¦ç¿’ã‚³ãƒ¼ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„")
        
        for tutorial_id, tutorial_data in self.tutorials.items():
            with st.container():
                col1, col2, col3, col4 = st.columns([3, 1, 1, 1])
                
                with col1:
                    st.markdown(f"### {tutorial_data['title']}")
                    st.write(tutorial_data['description'])
                
                with col2:
                    difficulty_color = {
                        "åˆç´š": "ğŸŸ¢",
                        "ä¸­ç´š": "ğŸŸ¡", 
                        "ä¸Šç´š": "ğŸ”´"
                    }
                    st.write(f"**é›£æ˜“åº¦**")
                    st.write(f"{difficulty_color.get(tutorial_data['difficulty'], 'âšª')} {tutorial_data['difficulty']}")
                
                with col3:
                    st.write(f"**æ‰€è¦æ™‚é–“**")
                    st.write(tutorial_data['duration'])
                
                with col4:
                    # é€²æ—è¡¨ç¤º
                    progress = st.session_state.tutorial_progress.get(tutorial_id, 0)
                    total_steps = len(tutorial_data['steps'])
                    st.write(f"**é€²æ—**")
                    st.write(f"{progress}/{total_steps}")
                    
                    if st.button(f"ğŸ“– é–‹å§‹", key=f"start_{tutorial_id}"):
                        st.session_state.current_tutorial = tutorial_id
                        st.session_state.current_step = st.session_state.tutorial_progress.get(tutorial_id, 0)
                        st.rerun()
                
                st.markdown("---")
    
    def _display_tutorial_content(self):
        """ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å†…å®¹è¡¨ç¤º"""
        tutorial_id = st.session_state.current_tutorial
        tutorial_data = self.tutorials[tutorial_id]
        current_step_index = st.session_state.current_step
        
        # ãƒ˜ãƒƒãƒ€ãƒ¼
        col1, col2, col3 = st.columns([2, 1, 1])
        
        with col1:
            st.subheader(f"ğŸ“– {tutorial_data['title']}")
        
        with col2:
            progress = (current_step_index + 1) / len(tutorial_data['steps'])
            st.progress(progress, text=f"é€²æ—: {current_step_index + 1}/{len(tutorial_data['steps'])}")
        
        with col3:
            if st.button("ğŸ“š ã‚³ãƒ¼ã‚¹ä¸€è¦§ã«æˆ»ã‚‹"):
                st.session_state.current_tutorial = None
                st.session_state.current_step = 0
                st.rerun()
        
        # ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—
        if current_step_index < len(tutorial_data['steps']):
            current_step = tutorial_data['steps'][current_step_index]
            
            st.markdown("---")
            st.markdown(f"## ã‚¹ãƒ†ãƒƒãƒ— {current_step_index + 1}: {current_step.title}")
            st.info(current_step.description)
            
            # ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤º
            st.markdown(current_step.content)
            
            # ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–è¦ç´ 
            if current_step.interactive_element:
                st.markdown("---")
                self._display_interactive_element(current_step.interactive_element, current_step)
            
            # ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
            st.markdown("---")
            col1, col2, col3 = st.columns([1, 1, 1])
            
            with col1:
                if current_step_index > 0:
                    if st.button("â¬…ï¸ å‰ã®ã‚¹ãƒ†ãƒƒãƒ—"):
                        st.session_state.current_step -= 1
                        st.rerun()
            
            with col2:
                if st.button("ğŸ’¾ é€²æ—ã‚’ä¿å­˜"):
                    st.session_state.tutorial_progress[tutorial_id] = current_step_index + 1
                    st.success("é€²æ—ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼")
            
            with col3:
                if current_step_index < len(tutorial_data['steps']) - 1:
                    if st.button("â¡ï¸ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—"):
                        st.session_state.current_step += 1
                        st.session_state.tutorial_progress[tutorial_id] = st.session_state.current_step
                        st.rerun()
                else:
                    if st.button("ğŸ‰ å®Œäº†"):
                        st.balloons()
                        st.success("ğŸ‰ ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å®Œäº†ï¼ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼")
                        st.session_state.tutorial_progress[tutorial_id] = len(tutorial_data['steps'])
                        st.session_state.current_tutorial = None
                        st.session_state.current_step = 0
                        st.rerun()
        
        else:
            st.success("ğŸ‰ ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯å®Œäº†ã—ã¦ã„ã¾ã™ï¼")
    
    def _display_interactive_element(self, element_type: str, step: TutorialStep):
        """ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–è¦ç´ è¡¨ç¤º"""
        st.markdown("### ğŸ® å®Ÿè·µç·´ç¿’")
        
        if element_type == "quiz":
            self._display_quiz(step)
        elif element_type == "calculation":
            self._display_calculation(step)
        elif element_type == "checklist":
            self._display_checklist(step)
        elif element_type == "calculator":
            self._display_calculator(step)
        elif element_type == "simulation":
            self._display_simulation(step)
        elif element_type == "chart_reading":
            self._display_chart_reading(step)
        elif element_type == "ma_practice":
            self._display_ma_practice(step)
        elif element_type == "oscillator_practice":
            self._display_oscillator_practice(step)
        elif element_type == "risk_assessment":
            self._display_risk_assessment(step)
        elif element_type == "diversification_game":
            self._display_diversification_game(step)
        elif element_type == "stop_loss_game":
            self._display_stop_loss_game(step)
    
    def _display_quiz(self, step: TutorialStep):
        """ã‚¯ã‚¤ã‚ºè¡¨ç¤º"""
        st.markdown("#### ğŸ’¡ ç†è§£åº¦ãƒã‚§ãƒƒã‚¯")
        
        if step.step_id == "basic_001":
            question = "æŠ•è³‡ã¨è²¯é‡‘ã®æœ€ã‚‚å¤§ããªé•ã„ã¯ä½•ã§ã™ã‹ï¼Ÿ"
            options = [
                "æŠ•è³‡ã®æ–¹ãŒé‡‘é¡ãŒå¤§ãã„",
                "æŠ•è³‡ã«ã¯ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ãŒã€ãƒªã‚¿ãƒ¼ãƒ³ã‚‚æœŸå¾…ã§ãã‚‹", 
                "æŠ•è³‡ã¯ç”·æ€§ãŒã™ã‚‹ã‚‚ã®",
                "æŠ•è³‡ã®æ–¹ãŒæ‰‹ç¶šããŒç°¡å˜"
            ]
            
            answer = st.radio(question, options)
            
            if st.button("å›ç­”ç¢ºèª"):
                if answer == options[1]:
                    st.success("âœ… æ­£è§£ï¼æŠ•è³‡ã¯ãƒªã‚¹ã‚¯ã‚’å–ã‚‹ä»£ã‚ã‚Šã«ã€ã‚ˆã‚Šé«˜ã„ãƒªã‚¿ãƒ¼ãƒ³ã‚’æœŸå¾…ã§ãã¾ã™ã€‚")
                else:
                    st.error("âŒ ä¸æ­£è§£ã€‚æŠ•è³‡ã®æœ€å¤§ã®ç‰¹å¾´ã¯ã€Œãƒªã‚¹ã‚¯ã¨ãƒªã‚¿ãƒ¼ãƒ³ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã€ã§ã™ã€‚")
    
    def _display_calculation(self, step: TutorialStep):
        """è¨ˆç®—ç·´ç¿’"""
        st.markdown("#### ğŸ§® è¨ˆç®—ã—ã¦ã¿ã‚ˆã†")
        
        if step.step_id == "basic_002":
            st.write("**å•é¡Œ**: 1000å††ã§100æ ªè²·ã£ãŸæ ªãŒ1200å††ã«ãªã‚Šã¾ã—ãŸã€‚")
            st.write("1. ã‚­ãƒ£ãƒ”ã‚¿ãƒ«ã‚²ã‚¤ãƒ³ã¯ã„ãã‚‰ã§ã™ã‹ï¼Ÿ")
            st.write("2. å¹´é–“é…å½“ãŒ1æ ª50å††ã®å ´åˆã€ã‚¤ãƒ³ã‚«ãƒ ã‚²ã‚¤ãƒ³ã¯ã„ãã‚‰ã§ã™ã‹ï¼Ÿ")
            
            col1, col2 = st.columns(2)
            
            with col1:
                capital_gain = st.number_input("ã‚­ãƒ£ãƒ”ã‚¿ãƒ«ã‚²ã‚¤ãƒ³ï¼ˆå††ï¼‰", min_value=0)
            
            with col2:
                income_gain = st.number_input("ã‚¤ãƒ³ã‚«ãƒ ã‚²ã‚¤ãƒ³ï¼ˆå††ï¼‰", min_value=0)
            
            if st.button("è¨ˆç®—çµæœç¢ºèª"):
                if capital_gain == 20000 and income_gain == 5000:
                    st.success("âœ… æ­£è§£ï¼ã‚­ãƒ£ãƒ”ã‚¿ãƒ«ã‚²ã‚¤ãƒ³: (1200-1000)Ã—100 = 20,000å††ã€ã‚¤ãƒ³ã‚«ãƒ ã‚²ã‚¤ãƒ³: 50Ã—100 = 5,000å††")
                else:
                    st.error("âŒ å†è¨ˆç®—ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ã‚­ãƒ£ãƒ”ã‚¿ãƒ«ã‚²ã‚¤ãƒ³ = (æ–°ä¾¡æ ¼-æ—§ä¾¡æ ¼)Ã—æ ªæ•°ã€ã‚¤ãƒ³ã‚«ãƒ ã‚²ã‚¤ãƒ³ = é…å½“Ã—æ ªæ•°")
    
    def _display_checklist(self, step: TutorialStep):
        """ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ"""
        st.markdown("#### âœ… æº–å‚™ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ")
        
        if step.step_id == "basic_003":
            items = [
                "æœ¬äººç¢ºèªæ›¸é¡ï¼ˆå…è¨±è¨¼ãƒ»ä¿é™ºè¨¼ãªã©ï¼‰ã‚’æº–å‚™ã—ãŸ",
                "ãƒã‚¤ãƒŠãƒ³ãƒãƒ¼æ›¸é¡ã‚’æº–å‚™ã—ãŸ",
                "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèªã—ãŸ",
                "éŠ€è¡Œå£åº§æƒ…å ±ã‚’æº–å‚™ã—ãŸ",
                "NISAã«ã¤ã„ã¦èª¿ã¹ãŸ"
            ]
            
            checked_items = []
            for item in items:
                if st.checkbox(item):
                    checked_items.append(item)
            
            progress = len(checked_items) / len(items)
            st.progress(progress, text=f"æº–å‚™å®Œäº†åº¦: {len(checked_items)}/{len(items)}")
            
            if len(checked_items) == len(items):
                st.success("ğŸ‰ å£åº§é–‹è¨­ã®æº–å‚™ãŒæ•´ã„ã¾ã—ãŸï¼")
    
    def _display_calculator(self, step: TutorialStep):
        """æŠ•è³‡è¨ˆç®—æ©Ÿ"""
        st.markdown("#### ğŸ’° æŠ•è³‡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³")
        
        if step.step_id == "basic_004":
            col1, col2 = st.columns(2)
            
            with col1:
                monthly_amount = st.slider("æœˆæŠ•è³‡é¡ï¼ˆä¸‡å††ï¼‰", 1, 10, 3)
                annual_return = st.slider("å¹´åˆ©ï¼ˆ%ï¼‰", 1, 10, 5)
                years = st.slider("æŠ•è³‡æœŸé–“ï¼ˆå¹´ï¼‰", 5, 30, 20)
            
            with col2:
                # è¤‡åˆ©è¨ˆç®—
                total_invested = monthly_amount * 10000 * 12 * years
                future_value = monthly_amount * 10000 * 12 * (((1 + annual_return/100)**(years) - 1) / (annual_return/100))
                profit = future_value - total_invested
                
                st.metric("ç·æŠ•è³‡é¡", f"{total_invested:,.0f}å††")
                st.metric("æœ€çµ‚è³‡ç”£é¡", f"{future_value:,.0f}å††")
                st.metric("åˆ©ç›Š", f"{profit:,.0f}å††", delta=f"+{(profit/total_invested)*100:.1f}%")
    
    def _display_simulation(self, step: TutorialStep):
        """æŠ•è³‡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³"""
        st.markdown("#### ğŸ® æŠ•è³‡ä½“é¨“ã‚²ãƒ¼ãƒ ")
        st.info("ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ã‚¿ãƒ–ã§å®Ÿéš›ã®å–å¼•ã‚’ä½“é¨“ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼")
    
    def _display_chart_reading(self, step: TutorialStep):
        """ãƒãƒ£ãƒ¼ãƒˆèª­è§£ç·´ç¿’"""
        st.markdown("#### ğŸ“Š ãƒãƒ£ãƒ¼ãƒˆèª­è§£ç·´ç¿’")
        st.info("å®Ÿéš›ã®ãƒãƒ£ãƒ¼ãƒˆåˆ†æã¯ãƒãƒ£ãƒ¼ãƒˆåˆ†æã‚¿ãƒ–ã§ç·´ç¿’ã§ãã¾ã™ã€‚")
    
    def _display_ma_practice(self, step: TutorialStep):
        """ç§»å‹•å¹³å‡ç·šç·´ç¿’"""
        st.markdown("#### ğŸ“ˆ ç§»å‹•å¹³å‡ç·šåˆ¤å®šç·´ç¿’")
        st.info("ã‚·ã‚°ãƒŠãƒ«åˆ†æã‚¿ãƒ–ã§ç§»å‹•å¹³å‡ç·šã®å®Ÿè·µçš„ãªä½¿ã„æ–¹ã‚’å­¦ã¹ã¾ã™ã€‚")
    
    def _display_oscillator_practice(self, step: TutorialStep):
        """ã‚ªã‚·ãƒ¬ãƒ¼ã‚¿ãƒ¼ç·´ç¿’"""
        st.markdown("#### ğŸ“Š ã‚ªã‚·ãƒ¬ãƒ¼ã‚¿ãƒ¼åˆ¤å®šç·´ç¿’")
        st.info("ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ã®è©³ç´°ãªä½¿ã„æ–¹ã¯ã‚·ã‚°ãƒŠãƒ«åˆ†æã‚¿ãƒ–ã§å®Ÿè·µã§ãã¾ã™ã€‚")
    
    def _display_risk_assessment(self, step: TutorialStep):
        """ãƒªã‚¹ã‚¯è©•ä¾¡"""
        st.markdown("#### âš–ï¸ ãƒªã‚¹ã‚¯è¨±å®¹åº¦è¨ºæ–­")
        
        questions = [
            ("å¹´é½¢ã¯ï¼Ÿ", ["20ä»£", "30ä»£", "40ä»£", "50ä»£ä»¥ä¸Š"]),
            ("æŠ•è³‡çµŒé¨“ã¯ï¼Ÿ", ["ãªã—", "1å¹´æœªæº€", "1-5å¹´", "5å¹´ä»¥ä¸Š"]),
            ("æŠ•è³‡ç›®æ¨™ã¯ï¼Ÿ", ["çŸ­æœŸåˆ©ç›Š", "ä¸­æœŸæˆé•·", "é•·æœŸè³‡ç”£å½¢æˆ", "è€å¾Œè³‡é‡‘"]),
            ("æå¤±è¨±å®¹åº¦ã¯ï¼Ÿ", ["çµ¶å¯¾ã«æã—ãŸããªã„", "5%ã¾ã§", "20%ã¾ã§", "50%ã¾ã§"])
        ]
        
        answers = []
        for i, (question, options) in enumerate(questions):
            answer = st.radio(f"{i+1}. {question}", options, key=f"risk_q_{i}")
            answers.append(answer)
        
        if st.button("ãƒªã‚¹ã‚¯è¨±å®¹åº¦åˆ¤å®š"):
            # ç°¡æ˜“çš„ãªåˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
            risk_score = 0
            if "20ä»£" in answers[0]: risk_score += 3
            elif "30ä»£" in answers[0]: risk_score += 2
            elif "40ä»£" in answers[0]: risk_score += 1
            
            if "5å¹´ä»¥ä¸Š" in answers[1]: risk_score += 3
            elif "1-5å¹´" in answers[1]: risk_score += 2
            elif "1å¹´æœªæº€" in answers[1]: risk_score += 1
            
            if "é•·æœŸè³‡ç”£å½¢æˆ" in answers[2]: risk_score += 3
            elif "ä¸­æœŸæˆé•·" in answers[2]: risk_score += 2
            
            if "50%ã¾ã§" in answers[3]: risk_score += 3
            elif "20%ã¾ã§" in answers[3]: risk_score += 2
            elif "5%ã¾ã§" in answers[3]: risk_score += 1
            
            if risk_score >= 8:
                st.success("ğŸ”´ é«˜ãƒªã‚¹ã‚¯è¨±å®¹å‹ï¼šæˆé•·æ ªæŠ•è³‡ã‚„å€‹åˆ¥æ ªæŠ•è³‡ã«é©ã—ã¦ã„ã¾ã™")
            elif risk_score >= 5:
                st.info("ğŸŸ¡ ä¸­ãƒªã‚¹ã‚¯è¨±å®¹å‹ï¼šãƒãƒ©ãƒ³ã‚¹å‹æŠ•è³‡ä¿¡è¨—ã‚„ETFãŒãŠã™ã™ã‚")
            else:
                st.warning("ğŸŸ¢ ä½ãƒªã‚¹ã‚¯è¨±å®¹å‹ï¼šå‚µåˆ¸ä¸­å¿ƒã‚„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æŠ•è³‡ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†")
    
    def _display_diversification_game(self, step: TutorialStep):
        """åˆ†æ•£æŠ•è³‡ã‚²ãƒ¼ãƒ """
        st.markdown("#### ğŸ¯ åˆ†æ•£æŠ•è³‡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³")
        
        st.write("100ä¸‡å††ã‚’ä»¥ä¸‹ã®æŠ•è³‡å…ˆã«é…åˆ†ã—ã¦ãã ã•ã„ï¼š")
        
        allocations = {}
        categories = ["æ—¥æœ¬å¤§å‹æ ª", "æ—¥æœ¬å°å‹æ ª", "ç±³å›½æ ª", "æ¬§å·æ ª", "æ–°èˆˆå›½æ ª", "å‚µåˆ¸", "ç¾é‡‘"]
        
        total_allocation = 0
        for category in categories:
            allocation = st.slider(f"{category}ï¼ˆ%ï¼‰", 0, 100, 0, key=f"alloc_{category}")
            allocations[category] = allocation
            total_allocation += allocation
        
        st.write(f"ç·é…åˆ†: {total_allocation}%")
        
        if total_allocation == 100:
            st.success("âœ… é…åˆ†å®Œäº†ï¼")
            
            # ç°¡æ˜“çš„ãªãƒªã‚¹ã‚¯ãƒ»ãƒªã‚¿ãƒ¼ãƒ³è¨ˆç®—
            risk_weights = {"æ—¥æœ¬å¤§å‹æ ª": 0.8, "æ—¥æœ¬å°å‹æ ª": 1.2, "ç±³å›½æ ª": 0.9, "æ¬§å·æ ª": 0.9, "æ–°èˆˆå›½æ ª": 1.5, "å‚µåˆ¸": 0.3, "ç¾é‡‘": 0}
            return_weights = {"æ—¥æœ¬å¤§å‹æ ª": 0.06, "æ—¥æœ¬å°å‹æ ª": 0.08, "ç±³å›½æ ª": 0.07, "æ¬§å·æ ª": 0.06, "æ–°èˆˆå›½æ ª": 0.09, "å‚µåˆ¸": 0.02, "ç¾é‡‘": 0}
            
            portfolio_risk = sum(allocations[cat] * risk_weights[cat] for cat in categories) / 100
            portfolio_return = sum(allocations[cat] * return_weights[cat] for cat in categories) / 100
            
            col1, col2 = st.columns(2)
            with col1:
                st.metric("ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªãƒªã‚¹ã‚¯", f"{portfolio_risk:.2f}")
            with col2:
                st.metric("æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³", f"{portfolio_return:.1%}")
        
        elif total_allocation != 100:
            st.warning(f"âš ï¸ é…åˆ†ãŒ{total_allocation}%ã§ã™ã€‚100%ã«ãªã‚‹ã‚ˆã†èª¿æ•´ã—ã¦ãã ã•ã„ã€‚")
    
    def _display_stop_loss_game(self, step: TutorialStep):
        """æåˆ‡ã‚Šã‚²ãƒ¼ãƒ """
        st.markdown("#### âœ‚ï¸ æåˆ‡ã‚Šåˆ¤æ–­ã‚²ãƒ¼ãƒ ")
        
        st.write("**ã‚·ãƒŠãƒªã‚ª**: 1000å††ã§è³¼å…¥ã—ãŸæ ªãŒä»¥ä¸‹ã®ã‚ˆã†ã«æ¨ç§»ã—ã¦ã„ã¾ã™ã€‚")
        
        scenarios = [
            ("è³¼å…¥ç¿Œæ—¥", 950, "5%ä¸‹è½"),
            ("1é€±é–“å¾Œ", 900, "10%ä¸‹è½"),
            ("1ãƒ¶æœˆå¾Œ", 850, "15%ä¸‹è½"),
            ("3ãƒ¶æœˆå¾Œ", 800, "20%ä¸‹è½")
        ]
        
        for time, price, change in scenarios:
            with st.expander(f"{time}: {price}å†† ({change})"):
                st.write(f"ç¾åœ¨ä¾¡æ ¼: {price}å††")
                st.write(f"å«ã¿æ: {1000-price}å†† ({change})")
                
                action = st.radio(
                    "ã‚ãªãŸã®è¡Œå‹•ã¯ï¼Ÿ",
                    ["ä¿æœ‰ç¶™ç¶š", "æåˆ‡ã‚Šå£²å´", "è¿½åŠ è³¼å…¥"],
                    key=f"action_{price}"
                )
                
                if action == "ä¿æœ‰ç¶™ç¶š":
                    st.info("ğŸ’­ ã€Œã¾ã æˆ»ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€")
                elif action == "æåˆ‡ã‚Šå£²å´":
                    st.warning("âœ‚ï¸ æåˆ‡ã‚Šå®Ÿè¡Œã€‚æå¤±ã‚’é™å®šã—ã¾ã—ãŸã€‚")
                elif action == "è¿½åŠ è³¼å…¥":
                    st.error("âš ï¸ ãƒŠãƒ³ãƒ”ãƒ³è²·ã„ã€‚ã•ã‚‰ã«ãƒªã‚¹ã‚¯ãŒå¢—åŠ ã—ã¾ã™ã€‚")
        
        st.markdown("---")
        st.info("ğŸ’¡ **å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ**: äº‹å‰ã«æåˆ‡ã‚Šãƒ«ãƒ¼ãƒ«ã‚’æ±ºã‚ã¦ã€æ„Ÿæƒ…ã«å·¦å³ã•ã‚Œãšã«å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚")


def render_education_tutorial_tab():
    """ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¿ãƒ–ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°"""
    component = EducationTutorialComponent()
    component.display()


if __name__ == "__main__":
    render_education_tutorial_tab()